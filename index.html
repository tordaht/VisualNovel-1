<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gölge Diyarın Şafak Söken Yüreği</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Georgia&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Cinzel', serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 100vh;
            max-height: 720px;
            display: flex;
            flex-direction: column;
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.7);
        }
        #scene-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: brightness(0.6) grayscale(0.2);
            transition: background-image 1s ease-in-out, filter 1s ease-in-out;
            z-index: 0;
        }
        #character-portrait {
            position: absolute;
            bottom: 25%;
            left: 10%;
            width: 180px;
            height: 240px;
            display: none;
            z-index: 2;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            border-radius: 9999px; /* Full rounded for circular portrait */
            overflow: hidden;
        }
        #dialogue-box {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            min-height: 200px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(8px);
            padding: 1.5rem;
            border-top: 2px solid rgba(75, 0, 130, 0.6);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 10;
        }
        #character-name {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            color: #a566ff;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 5px rgba(165, 102, 255, 0.5);
        }
        #dialogue-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            flex-grow: 1;
        }
        #choices-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
            justify-content: center;
        }
        #choices-container button {
            flex: 1 1 auto;
            min-width: 200px;
            max-width: 45%;
            padding: 0.75rem 1.25rem;
            background-color: #6a0dad;
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        #choices-container button:hover {
            background-color: #7b2ed0;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
        }
        #choices-container button:active {
            background-color: #5a099a;
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        #ui-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 0.5rem;
            z-index: 20;
        }
        #ui-buttons button {
            background-color: #333;
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
        #log-modal {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            padding: 1rem;
            overflow-y: auto;
            z-index: 30;
        }
        #log-modal.hidden {
            display: none;
        }
        #log-content {
            flex-grow: 1;
            margin-bottom: 1rem;
        }
        #close-log {
            align-self: flex-end;
            background-color: #6a0dad;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        #version-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.3);
            z-index: 10;
        }

        @media (max-width: 768px) {
            #game-container {
                height: 100vh;
                max-height: 100%;
                border-radius: 0;
            }
            #character-portrait {
                width: 120px;
                height: 160px;
                bottom: 30%;
                left: 5%;
            }
            #dialogue-box {
                min-height: 180px;
                padding: 1rem;
            }
            #character-name {
                font-size: 1.2rem;
            }
            #dialogue-text {
                font-size: 0.95rem;
                margin-bottom: 0.75rem;
            }
            #choices-container button {
                min-width: 100%;
                max-width: 100%;
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="scene-background"></div>
        <div id="character-portrait"></div>
        <div id="dialogue-box">
            <h2 id="character-name"></h2>
            <p id="dialogue-text"></p>
            <div id="choices-container"></div>
        </div>
        <div id="ui-buttons">
            <button id="save-btn">Kaydet</button>
            <button id="load-btn">Yükle</button>
            <button id="log-btn">Geçmiş</button>
        </div>
        <div id="log-modal" class="hidden">
            <div id="log-content"></div>
            <button id="close-log">Kapat</button>
        </div>
        <div id="version-info">Gölge Diyarın Şafak Söken Yüreği v1.0</div>
        <audio id="bg-music" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9c58d09b0e.mp3?filename=fairy-16848.mp3" loop></audio>
    </div>

    <script>
        const gameData = {
            "start": {
                background: "imgs/Giriş Holü.png",
                character: "Anlatıcı",
                portrait: "imgs/Acilis Logo.png",
                dialogue: "Yeraltının sonsuz derinliklerinde, kadim taşlarla oyulmuş, gaddar bir matriarkal toplum olan Karonya'da, Gölge Elfleri hüküm sürmektedir. Bu karanlığın ortasında, sıra dışı bir kalp atışı duyulur: Asil bir evde doğmuş, mor renkli gözleriyle farklılaşan genç bir elf olan Kael...",
                choices: [
                    { text: "Kael'in hikayesine başla", nextScene: "bolum1_giris" }
                ]
            },
            "bolum1_giris": {
                background: "imgs/Giriş Holü.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael'in mor gözlerle doğumu, Akasha'nın hoşnutsuzluğuna neden oldu. Drow geleneğine göre, bu bir kurban gerektirirdi. Ancak, kardeşin Zephyr'in beklenmedik ölümü, seni kurban edilmekten kurtardı ve evin üçüncü yaşayan oğlu olarak kalmanı sağladı. Çocukluğun ablan Vael'in acımasız eğitimleriyle geçti.",
                choices: [
                    { text: "Vael'in eğitimine odaklan", nextScene: "sn1_1_vael_egitim" }
                ]
            },
            "sn1_1_vael_egitim": {
                background: "imgs/tordah_tense_confrontation_scene_guard_in_period_uniform_stan_32539f47-26f0-471a-8947-96d082395d5c_2.png",
                character: "Vael",
                portrait: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_d4717972-1e6b-4911-a8a7-87127193eeb2_3.png",
                dialogue: "Zayıf olma Kael! Halkımızın beklediği gücü göster! Bu baskıya nasıl karşılık vereceksin?",
                choices: [
                    { text: "Boyun Eğme ve Uyum Sağlama", nextScene: "sn1_1_boyun_egme", effect: { path: "merhametli_point", impact: 1 } },
                    { text: "Direnç ve Sorgulama", nextScene: "sn1_1_direnme", effect: { path: "acimasiz_point", impact: 1 } }
                ]
            },
            "sn1_1_boyun_egme": {
                background: "imgs/tordah_tense_confrontation_scene_guard_in_period_uniform_stan_32539f47-26f0-471a-8947-96d082395d5c_2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Vael'in her dediğini yaptın, sorgulamadın. Onun gözünde biraz daha kabul gördün, ancak içindeki merhamet ateşi daha da büyüdü. Gelecekteki ahlaki seçimlerin daha zorlayıcı hale geldi.",
                choices: [
                    { text: "Darius ile kılıç derslerine geç", nextScene: "sn1_2_dovus_felsefesi" }
                ]
            },
            "sn1_1_direnme": {
                background: "imgs/tordah_tense_confrontation_scene_guard_in_period_uniform_stan_32539f47-26f0-471a-8947-96d082395d5c_2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Vael'in bazı yöntemlerini sorguladın, itiraz ettin. Hışmına uğradın ve daha fazla fiziksel ceza aldın. Ancak içindeki özgürlük ve adalet arzusu güçlendi. Darius'un dikkatini çektin.",
                choices: [
                    { text: "Darius ile kılıç derslerine geç", nextScene: "sn1_2_dovus_felsefesi" }
                ]
            },
            "sn1_2_dovus_felsefesi": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Darius",
                portrait: "imgs/tordah_elderly_distinguished_butler_in_formal_attire_skeptica_73fc41ac-e310-40e6-9343-36d5c1a6b565_2.png",
                dialogue: "Bir kılıç ustası, sadece öldürmeyi değil, aynı zamanda neden savaştığını da bilmelidir. Senin dövüşe bakış açın ne olacak?",
                choices: [
                    { text: "Geleneksel Drow Yöntemleri (Sadece öldürme)", nextScene: "sn1_2_geleneksel", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Adalet ve Koruma (Zayıfları koruma)", nextScene: "sn1_2_adalet", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn1_2_geleneksel": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Darius hayal kırıklığına uğradı, ancak ailen içindeki konumun güçlendi. Dövüşü sadece öldürme sanatı olarak gördün.",
                choices: [
                    { text: "Akademiye giriş", nextScene: "bolum2_giris" }
                ]
            },
            "sn1_2_adalet": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Darius gurur duydu, aranızdaki bağ güçlendi. Ancak bu düşünceler, Gölge Elfleri toplumunda seni tehlikeye attı.",
                choices: [
                    { text: "Akademiye giriş", nextScene: "bolum2_giris" }
                ]
            },
            "bolum2_giris": {
                background: "imgs/Kütüphane.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Akademi'deki eğitimine başladın. Dövüş sanatlarında yeteneğin hızla ortaya çıktı, ancak halkının acımasız doğasıyla olan çatışmaların devam etti.",
                choices: [
                    { text: "Cygnus ve Orion'un entrikalarına tanık ol", nextScene: "sn2_1_cinayet" }
                ]
            },
            "sn2_1_cinayet": {
                background: "imgs/GizliGecit.png",
                character: "Orion",
                portrait: "imgs/tordah_suspicious_contact_person_trench_coat_shadowy_face_cal_9c8805e5-1527-41ba-af10-3808b105be45_1.png",
                dialogue: "Hocam Cygnus'u ortadan kaldırmalıyız. Bu plana dahil olursan, ikimiz de güç kazanırız. Ne yapacaksın?",
                choices: [
                    { text: "Orion'a Yardım Etme", nextScene: "sn2_1_yardim_etme", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Müdahale Etmeme", nextScene: "sn2_1_mudahale_etmeme", effect: { path: "denge_point", impact: 1 } },
                    { text: "Cygnus'u Uyarma", nextScene: "sn2_1_uyarma", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn2_1_yardim_etme": {
                background: "imgs/GizliGecit2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Orion'a yardım ettin. Ona borçlu kaldın ve manipülasyonlarına maruz kaldın. Toplumda güç kazandın ancak vicdanın sarsıldı. Belki de bir gün Orion seni ele verir.",
                choices: [
                    { text: "Ayna olayına geç", nextScene: "sn2_2_ayna_olayi" }
                ]
            },
            "sn2_1_mudahale_etmeme": {
                background: "imgs/GizliGecit2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Cinayete engel olmadın, ancak aktif olarak yardım da etmedin. Orion tek başına hareket etti ve başarılı olursa sana karşı şüphe duydu. Vicdanın rahatladı, ancak toplumda daha az güç kazandın.",
                choices: [
                    { text: "Ayna olayına geç", nextScene: "sn2_2_ayna_olayi" }
                ]
            },
            "sn2_1_uyarma": {
                background: "imgs/GizliGecit.png",
                character: "Anlatıcı",
                portrait: "imgs/tordah_mysterious_librarian_with_intelligent_eyes_vintage_sch_b7cd77b1-edfc-444c-8270-ba1fd2f19545_1.png",
                dialogue: "Cygnus'u Orion'un planı hakkında uyardın. Cygnus, Orion'u alt etti. Güvenini kazandın ve daha sonra ondan önemli bir yardım alabilirsin.",
                choices: [
                    { text: "Ayna olayına geç", nextScene: "sn2_2_ayna_olayi" }
                ]
            },
            "sn2_2_ayna_olayi": {
                background: "imgs/Kütüphane.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Cygnus'un aynası aracılığıyla, De'Vir Evi'nin düşüşüyle ilgili rahatsız edici gerçeklere tanık oldun. Bu bilgiyi ne yapacaksın?",
                choices: [
                    { text: "Gördüklerini Saklama", nextScene: "sn2_2_saklama", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Darius ile Paylaşma", nextScene: "sn2_2_paylasma", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn2_2_saklama": {
                background: "imgs/Kütüphane.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Ailenin entrikalarını kimseye açıklamadın. Ailesinin gözünde 'sadık' kaldın, ancak gerçekler seni içten içe rahatsız etti.",
                choices: [
                    { text: "Yüzey görevine hazırlan", nextScene: "bolum3_giris" }
                ]
            },
            "sn2_2_paylasma": {
                background: "imgs/Kütüphane.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Gördüklerini Darius ile paylaştın. Darius, vicdanını takdir etti ve sana güvendi. Akıl hocalığı derinleşti.",
                choices: [
                    { text: "Yüzey görevine hazırlan", nextScene: "bolum3_giris" }
                ]
            },
            "bolum3_giris": {
                background: "imgs/tordah_mansion_rooftop_at_dusk_ornate_stone_railings_city_sky_6a9cba49-71ce-41ab-96eb-d82fc3f3804d_2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Devriye görevi için yüzeye gönderildin. Gölge Elfleri'nin 'ölümcül' olarak tanımladığı dış dünyayla ilk kez karşılaştın. Bu karşılaşma, senin dünya görüşünü derinden etkileyecek.",
                choices: [
                    { text: "İlk karşılaşmaya odaklan", nextScene: "sn3_1_ilk_karsilasma" }
                ]
            },
            "sn3_1_ilk_karsilasma": {
                background: "imgs/tordah_peaceful_courtyard_with_fountain_colorful_flowers_ston_11940f19-2f72-474b-8314-0c159b060cf1_0.png",
                character: "Yüzey Elfi",
                portrait: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_e6cc286b-a4c0-4413-a635-aafc2fc7a9d5_1.png",
                dialogue: "Masum yüzey elfleriyle karşılaştın. Onlara ne yapacaksın?",
                choices: [
                    { text: "Gölge Elfleri'nin Buyruğunu Uygulama (Saldır)", nextScene: "sn3_1_saldiri", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Direnme veya Pasif Direniş", nextScene: "sn3_1_direnis", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn3_1_saldiri": {
                background: "imgs/tordah_peaceful_courtyard_with_fountain_colorful_flowers_ston_11940f19-2f72-474b-8314-0c159b060cf1_0.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Ailenin gözünde 'başarılı' oldun, ancak içsel bir kriz yaşadın. Merhametini bastırdığın için büyük acı çektin.",
                choices: [
                    { text: "Panter dostluğu", nextScene: "sn3_2_panter" }
                ]
            },
            "sn3_1_direnis": {
                background: "imgs/tordah_peaceful_courtyard_with_fountain_colorful_flowers_ston_11940f19-2f72-474b-8314-0c159b060cf1_0.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Ailenin gözünde başarısız oldun ve cezalandırılabilirsin. Ancak vicdanın rahatladı ve karakterin 'Şafağın Yüreği' yolunda ilerledi. Darius'un desteğini kazandın.",
                choices: [
                    { text: "Panter dostluğu", nextScene: "sn3_2_panter" }
                ]
            },
            "sn3_2_panter": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_4189a663-0b8c-4594-8c72-903c37a5de8b_1.png",
                character: "Anlatıcı",
                portrait: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_3f889729-58b3-47fc-b1f2-4fe50866e5f3_0.png",
                dialogue: "Görevin sırasında panter Guenhwyvar ile karşılaştın. Onunla nasıl bir ilişki kuracaksın?",
                choices: [
                    { text: "Guenhwyvar'ı Sadece Bir Araç Olarak Görme", nextScene: "sn3_2_arac", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Gerçek Bir Dostluk Kurma", nextScene: "sn3_2_dostluk", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn3_2_arac": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_4189a663-0b8c-4594-8c72-903c37a5de8b_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Guenhwyvar ile ilişkin daha mesafeli kaldı. Onu yalnızca savaşta kullanabileceğin bir varlık olarak gördün.",
                choices: [
                    { text: "Darius'un itiraflarına geç", nextScene: "sn3_3_darius_itirafi" }
                ]
            },
            "sn3_2_dostluk": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_4189a663-0b8c-4594-8c72-903c37a5de8b_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Guenhwyvar, senin için önemli bir müttefik oldu ve zor zamanlarda sana yardım etti. Onunla duygusal bir bağ kurdun.",
                choices: [
                    { text: "Darius'un itiraflarına geç", nextScene: "sn3_3_darius_itirafi" }
                ]
            },
            "sn3_3_darius_itirafi": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Darius",
                portrait: "imgs/tordah_elderly_distinguished_butler_in_formal_attire_skeptica_73fc41ac-e310-40e6-9343-36d5c1a6b565_2.png",
                dialogue: "Bu toplumun acımasızlığından tiksiniyorum. Yalnız değilsin, Kael. Onun sözlerine nasıl tepki vereceksin?",
                choices: [
                    { text: "Darius'u Anlama ve Destekleme", nextScene: "sn3_3_destekleme", effect: { path: "merhametli_point", impact: 1 } },
                    { text: "Darius'un Sözlerine Şüpheyle Yaklaşma", nextScene: "sn3_3_supheyle", effect: { path: "acimasiz_point", impact: 1 } }
                ]
            },
            "sn3_3_destekleme": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael ve Darius arasındaki bağ daha da güçlendi. Gelecekteki olaylarda birbirlerine daha fazla güvendiler.",
                choices: [
                    { text: "Yeni düşmanla yüzleş", nextScene: "bolum4_giris" }
                ]
            },
            "sn3_3_supheyle": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_be5a1d37-92b9-49e5-bcc7-357420e63e46_1.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "İlişkiniz mesafeli kaldı. Kael, kendi yolunu yalnız çizmeye devam etti.",
                choices: [
                    { text: "Yeni düşmanla yüzleş", nextScene: "bolum4_giris" }
                ]
            },
            "bolum4_giris": {
                background: "imgs/Giriş Holü.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Gerilim doruğa ulaşıyor. Akasha, Gölge Elfleri toplumunun diğer soylu evlerinden gelen tehditlerle yüzleşir. Verdiğin kararlar, hem kendi hem de Gölge Diyarın kaderini belirleyecek.",
                choices: [
                    { text: "Ailenin planlarına odaklan", nextScene: "sn4_1_ihanet_guven" }
                ]
            },
            "sn4_1_ihanet_guven": {
                background: "imgs/Giriş Holü.png",
                character: "Akasha",
                portrait: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_c5c8149a-d688-47dd-a285-af5a9a3626d0_2.png",
                dialogue: "Ailenin planlarına nasıl yaklaşacaksın? Güven mi duyacaksın, yoksa kendi yolunu mu seçeceksin?",
                choices: [
                    { text: "Ailesine Güvenme", nextScene: "sn4_1_ailesine_guvenme", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Kendi Yolunu Seçme", nextScene: "sn4_1_kendi_yolunu_secme", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn4_1_ailesine_guvenme": {
                background: "imgs/Giriş Holü.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Ailenin entrikalarına daha fazla karıştın ve toplumdaki konumunu sağlamlaştırdın.",
                choices: [
                    { text: "Akasha'nın ayinine katıl", nextScene: "sn4_2_ayin" }
                ]
            },
            "sn4_1_kendi_yolunu_secme": {
                background: "imgs/Giriş Holü.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Ailenle aran açıldı, ancak kendi ahlaki pusulana sadık kaldın.",
                choices: [
                    { text: "Akasha'nın ayinine katıl", nextScene: "sn4_2_ayin" }
                ]
            },
            "sn4_2_ayin": {
                background: "imgs/treasure chamber.png",
                character: "Akasha",
                portrait: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_c5c8149a-d688-47dd-a285-af5a9a3626d0_2.png",
                dialogue: "Ayin sırasında, yüzeydeki elfleri öldürmeyi reddetmen ortaya çıktı. Şimdi ne yapacaksın?",
                choices: [
                    { text: "Yalan Söyleme / İnkar Etme", nextScene: "sn4_2_yalan_söyle", effect: { path: "acimasiz_point", impact: 1 } },
                    { text: "Gerçeği Söyleme", nextScene: "sn4_2_gercegi_söyle", effect: { path: "merhametli_point", impact: 1 } }
                ]
            },
            "sn4_2_yalan_söyle": {
                background: "imgs/treasure chamber.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Akasha'nın gazabından bir süreliğine kurtuldun, ancak vicdanın seni daha da rahatsız etti. Darius ve Guenhwyvar ile ilişkilerin olumsuz etkilenebilir.",
                choices: [
                    { text: "Darius'un fedakarlığı", nextScene: "sn4_3_darius_fedakarligi" }
                ]
            },
            "sn4_2_gercegi_söyle": {
                background: "imgs/treasure chamber.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Akasha'nın hışmına uğradın ve ağır bir şekilde cezalandırıldın. Ancak Darius ve Guenhwyvar'ın saygısını ve desteğini kazandın. Bu, 'Şafağın Yüreği' yolunu güçlendirdi.",
                choices: [
                    { text: "Darius'un fedakarlığı", nextScene: "sn4_3_darius_fedakarligi" }
                ]
            },
            "sn4_3_darius_fedakarligi": {
                background: "imgs/tordah_tense_confrontation_scene_guard_in_period_uniform_stan_32539f47-26f0-471a-8947-96d082395d5c_2.png",
                character: "Darius",
                portrait: "imgs/tordah_elderly_distinguished_butler_in_formal_attire_skeptica_73fc41ac-e310-40e6-9343-36d5c1a6b565_2.png",
                dialogue: "Seni korumak için fedakarlık yapacağım. Ne yapacaksın?",
                choices: [
                    { text: "Darius'u Dinleme ve Kaçma", nextScene: "end_merhametli", effect: { path: "merhametli_point", impact: 1 } },
                    { text: "Darius ile Kalma ve Savaşma", nextScene: "end_denge", effect: { path: "denge_point", impact: 1 } }
                ]
            },

            // Sonlar
            "end_merhametli": {
                background: "imgs/tordah_peaceful_courtyard_with_fountain_colorful_flowers_ston_11940f19-2f72-474b-8314-0c159b060cf1_0.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael, Gölge Elfleri toplumunu terk etti ve yüzeye kaçtı. Yüzeydeki elflerle veya diğer ırklarla yeni bir hayat kurmaya çalışıyor. Zorlu bir yolculuk olsa da, iç huzuru buldu. Şafağın Yüreği senaryosu.",
                choices: []
            },
            "end_acimasiz": {
                background: "imgs/tordah_hidden_treasure_chamber_ancient_artifacts_on_shelves_l_95989b09-1d9f-48ce-a08f-64f977a64546_3.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael, Gölge Elfleri'nin acımasız yolunu tamamen benimsedi. Güçlü bir savaşçı veya büyücü oldu, ancak merhametini kaybetti. Ailesi içinde yükseldi, ancak yalnız ve mutsuz bir hayat sürdü. Karanlığın Kalbi senaryosu.",
                choices: []
            },
            "end_denge": {
                background: "imgs/tordah_mansion_rooftop_at_dusk_ornate_stone_railings_city_sky_6a9cba49-71ce-41ab-96eb-d82fc3f3804d_2.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael, Gölge Elfleri toplumunda kaldı ancak kendi ahlaki prensiplerine bağlı kaldı. İki dünya arasında bir köprü olmaya çalışıyor, ancak her iki taraftan da şüpheyle karşılanıyor. Dengeyi korumak için sürekli mücadele ediyor. İki Dünya Arasında senaryosu.",
                choices: []
            },
            "end_trajik": {
                background: "imgs/tordah_cohesive_anime-visual-novel_aesthetic_consistent_color_8c34c4ba-0a8e-44a7-bd89-76fd5dc14257_0.png",
                character: "Anlatıcı",
                portrait: "",
                dialogue: "Kael, yaptığı seçimler sonucunda ailesi tarafından dışlandı ve yalnız kaldı. Ne yüzeyde ne de yeraltında kendine bir yer bulamadı. Trajik bir şekilde öldü veya sonsuza kadar yalnız kaldı. Yalnızlığın Bedeli senaryosu.",
                choices: []
            }
        };

       let currentSceneId = "start";
       let playerStats = {
           merhametli_points: 0,
           acimasiz_points: 0,
           denge_points: 0
       };
        let history = [];

       const sceneBackground = document.getElementById("scene-background");
       const characterPortrait = document.getElementById("character-portrait");
       const characterName = document.getElementById("character-name");
       const dialogueText = document.getElementById("dialogue-text");
        const dialogueBox = document.getElementById("dialogue-box");
       const choicesContainer = document.getElementById("choices-container");
        const saveBtn = document.getElementById("save-btn");
        const loadBtn = document.getElementById("load-btn");
        const logBtn = document.getElementById("log-btn");
        const logModal = document.getElementById("log-modal");
        const logContent = document.getElementById("log-content");
        const closeLog = document.getElementById("close-log");
        const bgMusic = document.getElementById("bg-music");

       function loadScene(sceneId) {
           const scene = gameData[sceneId];
           if (!scene) {
               loadScene("end_trajik");
               return;
           }

           currentSceneId = sceneId;
            dialogueBox.style.opacity = 0;
            setTimeout(() => {
                sceneBackground.style.backgroundImage = `url('${scene.background}')`;
                characterName.textContent = scene.character;
                dialogueText.textContent = scene.dialogue;

                characterPortrait.innerHTML = scene.portrait ? `<img src="${scene.portrait}" alt="${scene.character}" class="w-full h-full object-cover rounded-full border-4 border-gray-700 shadow-lg">` : '';
                characterPortrait.style.display = scene.portrait ? 'block' : 'none';

                dialogueBox.style.opacity = 1;
            }, 200);

            history.push(`${scene.character}: ${scene.dialogue}`);

           choicesContainer.innerHTML = "";

            if (scene.choices && scene.choices.length > 0) {
                scene.choices.forEach((choice, index) => {
                    const button = document.createElement("button");
                    button.textContent = choice.text;
                    button.classList.add(
                        "w-full", "px-4", "py-3", "bg-purple-700", "text-white", "font-semibold", "rounded-xl",
                        "hover:bg-purple-800", "transition-colors", "duration-200", "shadow-md", "transform", "hover:scale-105", "focus:outline-none", "focus:ring-2", "focus:ring-purple-500", "focus:ring-opacity-75"
                    );
                    button.addEventListener("click", () => makeChoice(index));
                    choicesContainer.appendChild(button);
                });
            } else {
                const restartButton = document.createElement("button");
                restartButton.textContent = "Yeniden Başla";
                restartButton.classList.add(
                    "w-full", "px-4", "py-3", "bg-green-700", "text-white", "font-semibold", "rounded-xl",
                    "hover:bg-green-800", "transition-colors", "duration-200", "shadow-md", "transform", "hover:scale-105", "focus:outline-none", "focus:ring-2", "focus:ring-green-500", "focus:ring-opacity-75"
                );
                restartButton.addEventListener("click", startGame);
                choicesContainer.appendChild(restartButton);
            }
        }

       function makeChoice(choiceIndex) {
           const scene = gameData[currentSceneId];
           const chosen = scene.choices[choiceIndex];

            if (chosen.effect) {
                if (chosen.effect.path === "merhametli_point") {
                    playerStats.merhametli_points += chosen.effect.impact;
                } else if (chosen.effect.path === "acimasiz_point") {
                    playerStats.acimasiz_points += chosen.effect.impact;
                } else if (chosen.effect.path === "denge_point") {
                    playerStats.denge_points += chosen.effect.impact;
                }
            }

           if (chosen.nextScene.startsWith("end_")) {
               loadEndingScene();
           } else {
               loadScene(chosen.nextScene);
           }
       }

        function updateLog() {
            logContent.innerHTML = history.map(h => `<p>${h}</p>`).join("");
        }

        function saveGame() {
            localStorage.setItem('gameSave', JSON.stringify({
                currentSceneId,
                playerStats,
                history
            }));
        }

        function loadGame() {
            const data = localStorage.getItem('gameSave');
            if (data) {
                const obj = JSON.parse(data);
                playerStats = obj.playerStats;
                history = obj.history || [];
                loadScene(obj.currentSceneId);
                updateLog();
            }
        }

        function loadEndingScene() {
            let finalEnding = "end_trajik";

            if (playerStats.merhametli_points > playerStats.acimasiz_points && playerStats.merhametli_points > playerStats.denge_points) {
                finalEnding = "end_merhametli";
            } else if (playerStats.acimasiz_points > playerStats.merhametli_points && playerStats.acimasiz_points > playerStats.denge_points) {
                finalEnding = "end_acimasiz";
            } else if (playerStats.denge_points > playerStats.merhametli_points && playerStats.denge_points > playerStats.acimasiz_points) {
                finalEnding = "end_denge";
            } else if (playerStats.merhametli_points === playerStats.acimasiz_points && playerStats.merhametli_points > 0) {
                finalEnding = "end_denge";
            } else if (playerStats.merhametli_points === playerStats.denge_points && playerStats.merhametli_points > 0) {
                finalEnding = "end_denge";
            } else if (playerStats.acimasiz_points === playerStats.denge_points && playerStats.acimasiz_points > 0) {
                finalEnding = "end_denge";
            }
            // If all are 0 or tied at 0, it leads to tragic
            else if (playerStats.merhametli_points === 0 && playerStats.acimasiz_points === 0 && playerStats.denge_points === 0) {
                finalEnding = "end_trajik";
            }


            loadScene(finalEnding);
        }

       function startGame() {
           playerStats = {
               merhametli_points: 0,
               acimasiz_points: 0,
               denge_points: 0
           };
            history = [];
            loadScene("start");
            bgMusic.play().catch(()=>{});
       }

        document.addEventListener("DOMContentLoaded", () => {
            startGame();
            saveBtn.addEventListener('click', saveGame);
            loadBtn.addEventListener('click', loadGame);
            logBtn.addEventListener('click', () => { logModal.classList.remove('hidden'); updateLog(); });
            closeLog.addEventListener('click', () => logModal.classList.add('hidden'));
        });
    </script>
</body>
</html>
